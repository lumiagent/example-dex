import{r as i,j as e}from"./index-6DuipDjQ.js";import{aU as X,aV as V,aW as Y,aX as q,aY as z,aZ as Z,a_ as G,a$ as E,b0 as ee,b1 as se,b2 as A,b3 as te,b4 as ae,b5 as ne,b6 as S}from"./Spinner-Bnv09v-B.js";import{u as H,P as U}from"./PendingButton-Dp7gbznA.js";import{m as re,b as oe,P as F,R as P,T as R,u as $,a as ie,c as ce,d as M,f as k,e as le,z as L}from"./TokenInput-DJKwlXha.js";const de=()=>{const[f]=H(),d=X(),{account:h,state:{status:y}}=V(),[a]=Y(f?"testnet":"mainnet"),[x,w]=q(),n=i.useMemo(()=>{var r;return(r=a.find(o=>o.network_infos.chain_id===h.chainId))==null?void 0:r.token_infos[0]},[a,h.chainId]),C=z({address:n==null?void 0:n.address,decimals:n==null?void 0:n.decimals,srcToken:n==null?void 0:n.symbol,srcChainId:Number(h.chainId)}),g=i.useMemo(()=>y>=Z.Connected?C.balance:void 0,[y,C,h.chainId]),{withdraw:b,availableWithdraw:N}=G();return e.jsxs("div",{className:"flex flex-col gap-8",children:[e.jsx(re,{children:e.jsxs(oe,{children:[e.jsxs(F,{children:[e.jsx(P,{children:"Wallet Balance:"}),e.jsxs(R,{className:"text-right",children:[$.format(Number(g??"0"))," $"]})]}),e.jsxs(F,{children:[e.jsx(P,{children:"Orderly Balance:"}),e.jsxs(R,{className:"text-right",children:[$.format(d.availableBalance)," $"]})]})]})}),e.jsx(ue,{walletBalance:E.fromString(g??"0",{decimals:6}),orderlyBalance:E.fromString(d.availableBalance.toPrecision(6),{decimals:6}),availableWithdraw:E.fromString(N.toPrecision(6),{decimals:6}),withdraw:b}),e.jsx(U,{onClick:async()=>{const{update:r}=w({eventCode:"settle",type:"pending",message:"Settling PnL..."});try{await h.settle(),r({eventCode:"settleSuccess",type:"success",message:"Successfully settled PnL!",autoDismiss:5e3})}catch(o){console.error(o),r({eventCode:"settleError",type:"error",message:o.message??"Something went wrong",autoDismiss:15e3})}},children:"Settle PnL"})]})},ue=({walletBalance:f,orderlyBalance:d,availableWithdraw:h,withdraw:y})=>{const[a,x]=i.useState(),[w,n]=i.useState(!1),[C,g]=i.useState(!0),[b,N]=i.useState(!1),[r,o]=i.useState(),[v,p]=i.useState(),[me,j]=q(),[_]=H(),{account:u,state:D}=V(),[I]=Y(_?"testnet":"mainnet"),l=i.useMemo(()=>{var m;return(m=I.find(s=>s.network_infos.chain_id===u.chainId))==null?void 0:m.token_infos[0]},[I,u.chainId]),{deposit:J,approve:K,allowance:O,setQuantity:W}=z({address:l==null?void 0:l.address,decimals:l==null?void 0:l.decimals,srcToken:l==null?void 0:l.symbol,srcChainId:Number(u.chainId)});i.useEffect(()=>{a!=null&&W(a.toString())},[a,W]),i.useEffect(()=>{!v||!r||v.toUnsafeFloat()<0||r.toUnsafeFloat()<0?g(!0):g(!1)},[v,r]),i.useEffect(()=>{w||(x(void 0),o(void 0),p(void 0))},[w]);const T=m=>e.jsxs("div",{className:"flex flex-col gap-6 mt-6",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{children:"Wallet balance (USDC):"}),e.jsxs("div",{className:"flex flex-items-center",children:[e.jsx("span",{className:"flex-1",children:f.toString()}),r!=null&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"⇒"}),e.jsx("span",{className:`flex-1 text-end ${r.toUnsafeFloat()<f.toUnsafeFloat()?"color-red":"color-green"}`,children:r.toString()})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{children:"Orderly balance (USDC):"}),e.jsxs("div",{className:"flex flex-items-center",children:[e.jsx("span",{className:"flex-1",children:d.toString()}),v!=null&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"⇒"}),e.jsx("span",{className:`flex-1 text-end ${v.toUnsafeFloat()<d.toUnsafeFloat()?"color-red":"color-green"}`,children:v.toString()})]})]})]}),e.jsx(le,{decimals:6,onValueChange:s=>{if(s.value===0n){x(void 0),o(void 0),p(void 0);return}x(s),m?(o(f.sub(s)),p(d.add(s))):(o(f.add(s)),p(d.sub(s)))}}),e.jsx(U,{disabled:C,onClick:async()=>{if(a!=null)if(m)if(Number(O)<a.toUnsafeFloat()){const{update:s}=j({eventCode:"approval",type:"pending",message:"Approving USDC for deposit..."});try{await K(a.toString()),s({eventCode:"approvalSuccess",type:"success",message:"Approval complete! You can now do a deposit",autoDismiss:8e3})}catch(t){throw console.error(t),s({eventCode:"approvalError",type:"error",message:"Approval failed!",autoDismiss:5e3}),t}}else{const{update:s}=j({eventCode:"deposit",type:"pending",message:"Depositing USDC into your Orderly Account..."});try{await J(),s({eventCode:"depositSuccess",type:"success",message:"Deposit complete!",autoDismiss:5e3}),x(void 0),o(void 0),p(void 0)}catch(t){throw console.error(t),s({eventCode:"depositError",type:"error",message:"Deposit failed!",autoDismiss:5e3}),t}}else{if(h.lt(d)){const{update:t}=j({eventCode:"settle",type:"pending",message:"Settling PnL..."});try{await u.settle(),t({eventCode:"settleSuccess",type:"success",message:"Successfully settled PnL!",autoDismiss:5e3})}catch(c){console.error(c),t({eventCode:"settleError",type:"error",message:c.message??"Something went wrong",autoDismiss:15e3})}}const{update:s}=j({eventCode:"withdraw",type:"pending",message:"Withdrawing USDC from your Orderly Account..."});try{await y({chainId:Number(u.chainId),amount:a.toString(),token:"USDC",allowCrossChainWithdraw:!1}),s({eventCode:"withdrawSuccess",type:"success",message:"Withdraw complete!",autoDismiss:5e3}),x(void 0),o(void 0),p(void 0)}catch(t){throw console.error(t),s({eventCode:"withdrawError",type:"error",message:"Withdraw failed!",autoDismiss:5e3}),t}}},children:m?a!=null&&Number(O)<a.toUnsafeFloat()?"Approve":"Deposit":"Withdraw"}),_&&D.chainNamespace!=null&&e.jsx(U,{disabled:b,onClick:async()=>{if(D.chainNamespace==null)return;const{update:s}=j({eventCode:"mint",type:"pending",message:"Minting USDC on testnet..."});try{const t=D.chainNamespace,c=await fetch(L(t).with(S.evm,()=>"https://testnet-operator-evm.orderly.org/v1/faucet/usdc").with(S.solana,()=>"https://testnet-operator-sol.orderly.org/v1/faucet/usdc").exhaustive(),{method:"POST",headers:{"Content-Type":"application/json"},body:L(t).with(S.evm,()=>JSON.stringify({broker_id:"YOUR_BROKER_ID_HERE",chain_id:String(Number(u.chainId)),user_address:u.address})).with(S.solana,()=>JSON.stringify({broker_id:"YOUR_BROKER_ID_HERE",user_address:u.address})).exhaustive()});if(!c.ok)throw new Error(c.status===429?"Too many requests":c.statusText);const{success:B,message:Q}=await c.json();if(!B)throw new Error(Q);s({eventCode:"mintSuccess",type:"success",message:"Mint success! It might take a while to be received in your Orderly account",autoDismiss:8e3}),N(!0)}catch(t){if(console.error(t),s){let c;t instanceof Error?c=t.message:c="Mint failed!",s({eventCode:"mintError",type:"error",message:c,autoDismiss:5e3})}throw t}},children:"Request USDC via faucet"})]});return e.jsxs(ee,{open:w,onOpenChange:n,children:[e.jsx(se,{children:e.jsx(A,{children:"Deposit / Withdraw"})}),e.jsxs(te,{className:"max-w-xs",size:"2",onInteractOutside:m=>{m.preventDefault()},children:[e.jsxs(ae,{className:"flex justify-between flex-items-center",children:[e.jsx("span",{className:"mr-2",children:"Deposit / Withdraw"}),e.jsx(A,{variant:"ghost",color:"crimson",onClick:()=>{n(!1)},children:e.jsx(ne,{})})]}),e.jsxs(ie,{defaultValue:"deposit",onValueChange:()=>{p(void 0),o(void 0)},children:[e.jsxs(ce,{children:[e.jsx(M,{value:"deposit",children:"Deposit"}),e.jsx(M,{value:"withdraw",children:"Withdraw"})]}),e.jsx(k,{value:"deposit",children:T(!0)}),e.jsx(k,{value:"withdraw",children:T(!1)})]})]})]})};function ge(){return e.jsxs("div",{className:"max-w-full w-md",children:[e.jsx("h1",{className:"mb-8",children:"Account"}),e.jsx("div",{children:e.jsx(de,{})})]})}export{ge as default};
